<% @title="Create a new Midway - Start your journey" %>

<div class="form-container" style="height: 100vh;">
  <h2>Customize your Midway</h2>
  <div class="midway-container-new">
  <!--   <form id="regForm" action=""> -->
    <form novalidate="novalidate" class="simple_form midway" action="/midways" accept-charset="UTF-8" method="post"><input type="hidden" name="authenticity_token" value="<%= form_authenticity_token %>">

    <!-- One "tab" for each step in the form: -->
    <div class="tab" style="display: block;">

      <fieldset class="form-group check_boxes required midway_friends_participants">
        <legend class="col-form-label pt-0">Choose your friends <abbr title="required">*</abbr></legend>
        <div class="category-wrapper">
          <input type="hidden" name="midway[friends][participants][]" value="">

          <% @friends.each do |friend| %>
          <div class="category-item">
            <input class="form-check-input check_boxes required category-selector" type="checkbox" data-style="ruby" value="<%= friend.id %>" name="midway[friends][participants][]" id="midway_friends_participants_<%= friend.id %>">
            <label class="form-check-label collection_check_boxes" for="midway_friends_participants_<%= friend.id %>"> <%= image_tag friend.photo, gravity: :face, class: "avatar" %> <%= friend.first_name %> <%= friend.last_name %> </label>
          </div>
          <% end %>

<!--           <div class="category-item">
            <a href="#" class="btn" id="guest-button">Add a guest</a>
          </div> -->

          <div class="category-item">
            <input class="form-check-input check_boxes required category-selector-guest" id="guest-input" type="checkbox" data-style="ruby" value="guest" name="midway[guest]">
            <label class="form-check-label collection_check_boxes" id="guest-button" for="guest-input"> <%= image_tag "user.png", class: "avatar" %> Add a guest </label>
          </div>

        </div>
      </fieldset>
      <!-- <p><input placeholder="First name..." oninput="this.className = ''"></p> -->
      <!-- <p><input placeholder="Last name..." oninput="this.className = ''"></p> -->
    </div>

    <div class="hidden" id="optional-tab">

      <div class="form-group string required guest_info">
        <label class="string required" for="guest_name">What's their name? <abbr title="required">*</abbr></label>
        <input class="form-control string required" placeholder="Chuck Bass" type="text" name="guest[name]" id="guest_name">
      </div>

      <div class="form-group string required guest_info">
        <label class="string required" for="guest_location">What's their location? <abbr title="required">*</abbr></label>
        <input class="form-control string required" placeholder="SW1A 0AS" type="text" name="guest[location]" id="guest_location">
      </div>

      <a href="#"></a>

    </div>

    <div class="tab">
      <fieldset class="form-group radio_buttons required midway_time_option">
        <legend class="col-form-label pt-0">When are you going? <abbr title="required">*</abbr></legend>
        <input type="hidden" name="midway[time_option]" value="">
        <div class="time-tab">
          <ul>
            <li>
              <div class="form-check">
                <input class="form-check-input radio_buttons required" type="radio" value="0" name="midway[time_option]" id="midway_time_option_0">
                <label class="form-check-label collection_radio_buttons" for="midway_time_option_0">Departure time</label>
                <div class="check"></div>
              </div>
            </li>
            <li>
              <div class="form-check">
                <input class="form-check-input radio_buttons required" type="radio" value="1" name="midway[time_option]" id="midway_time_option_1">
                <label class="form-check-label collection_radio_buttons" for="midway_time_option_1">Arrival time</label>
                <div class="check"></div>
              </div>
            </li>
          </ul>
        </div>
      </fieldset>

      <div class="select-time row">
        <div class="form-group string optional midway_future_date">
          <label class="string optional" for="midway_future_date"><i class="fas fa-calendar-alt mr-2"></i> Select a date:</label>
          <input class="form-control string optional datepicker flatpickr-input" type="text" name="midway[future_date]" id="midway_future_date" readonly="readonly">
        </div>

        <div class="form-group string optional midway_future_time">
          <label class="string optional" for="midway_future_time"><i class="fas fa-clock mr-2"></i> Select a time:</label>
          <input class="form-control string optional timepicker flatpickr-input" type="text" name="midway[future_time]" id="midway_future_time" readonly="readonly">
        </div>
      </div>

  <!--     <p><input placeholder="E-mail..." oninput="this.className = ''"></p>
      <p><input placeholder="Phone..." oninput="this.className = ''"></p> -->
    </div>

    <div class="tab">
      <fieldset class="form-group radio_buttons required midway_venue_type">
        <legend class="col-form-label pt-0">What do you want to do? <abbr title="required">*</abbr></legend>
        <div class="venue-category-wrapper">
          <input type="hidden" name="midway[venue_type]" value="">

          <div class="venue-category-item">
            <input class="form-check-input radio_buttons required venue-category-selector midway-venue" type="radio" value="restaurant" name="midway[venue_type]" id="midway_venue_type_restaurant">
            <label class="form-check-label collection_radio_buttons" for="midway_venue_type_restaurant"><div class="div-image-restaurant"></div>Restaurant</label>
          </div>

          <div class="venue-category-item">
            <input class="form-check-input radio_buttons required venue-category-selector midway-venue" type="radio" value="bar" name="midway[venue_type]" id="midway_venue_type_bar">
            <label class="form-check-label collection_radio_buttons" for="midway_venue_type_bar"><div class="div-image-beer"></div>Pub</label>
          </div>

          <div class="venue-category-item">
            <input class="form-check-input radio_buttons required venue-category-selector midway-venue" type="radio" value="movie_theater" name="midway[venue_type]" id="midway_venue_type_movie_theater">
            <label class="form-check-label collection_radio_buttons" for="midway_venue_type_movie_theater"><div class="div-image-cinema"></div>Cinema</label>
          </div>

          <div class="venue-category-item">
            <input class="form-check-input radio_buttons required venue-category-selector midway-venue" type="radio" value="park" name="midway[venue_type]" id="midway_venue_type_park">
            <label class="form-check-label collection_radio_buttons" for="midway_venue_type_park"><div class="div-image-park"></div>Park</label>
          </div>

          <div class="venue-category-item">
            <input class="form-check-input radio_buttons required venue-category-selector midway-venue" type="radio" value="art_gallery" name="midway[venue_type]" id="midway_venue_type_art_gallery">
            <label class="form-check-label collection_radio_buttons" for="midway_venue_type_art_gallery"><div class="div-image-artgallery"></div>Art Gallery</label>
          </div>

          <div class="venue-category-item">
            <input class="form-check-input radio_buttons required venue-category-selector midway-venue" type="radio" value="museum" name="midway[venue_type]" id="midway_venue_type_museum">
            <label class="form-check-label collection_radio_buttons" for="midway_venue_type_museum"><div class="div-image-museum"></div>Museum</label>
          </div>

          <div class="venue-category-item">
            <input class="form-check-input radio_buttons required venue-category-selector midway-venue" type="radio" value="night_club" name="midway[venue_type]" id="midway_venue_type_night_club">
            <label class="form-check-label collection_radio_buttons" for="midway_venue_type_night_club"><div class="div-image-nightclub"></div>Nightclub</label>
          </div>

          <div class="venue-category-item">
            <input class="form-check-input radio_buttons required venue-category-selector midway-venue" type="radio" value="cafe" name="midway[venue_type]" id="midway_venue_type_cafe">
            <label class="form-check-label collection_radio_buttons" for="midway_venue_type_cafe"><div class="div-image-cafe"></div>Cafe</label>
          </div>

          <div class="venue-category-item">
            <input class="form-check-input radio_buttons required venue-category-selector midway-venue" type="radio" value="bowling_alley" name="midway[venue_type]" id="midway_venue_type_bowling_alley">
            <label class="form-check-label collection_radio_buttons" for="midway_venue_type_bowling_alley"><div class="div-image-bowling"></div>Bowling</label>
          </div>

          <div class="venue-category-item">
            <input class="form-check-input radio_buttons required venue-category-selector-shopping midway-venue" type="radio" value="shopping_mall" name="midway[venue_type]" id="midway_venue_type_shopping_mall">
            <label class="form-check-label collection_radio_buttons" for="midway_venue_type_shopping_mall"><div class="div-image-shopping"></div>Shopping Centre</label>
          </div>
        </div>
      </fieldset>
      <input type="submit" name="commit" value="Find our Midway" class="btn submit-button hidden" id="submit-one" data-disable-with="Find our Midway">
  <!--     <p><input placeholder="Username..." oninput="this.className = ''"></p>
      <p><input placeholder="Password..." oninput="this.className = ''"></p> -->
    </div>

  <!-- Only if restaurant is selected -->
    <div class="tab">
      <div class="form-group string required midway_keyword">
        <label class="string" for="midway_keyword">What cuisine do you fancy? (Optional)</label>
        <input class="form-control string required" placeholder="Italian, Indian, French..." type="text" name="midway[keyword]" id="midway_keyword">
      </div>

      <div class="form-group string required midway_choice">
        <label class="string" for="midway_choice">How would you like us to calculate our Midawy? (Optional)</label>
        <input class="form-control string required" placeholder="Efficient or Equal" type="text" name="midway[choice]" id="midway_choice">
      </div>
      <input type="submit" name="commit" value="Find our Midway" class="btn submit-button" id="submit-two" data-disable-with="Find our Midway">
  <!--     <p><input placeholder="Username..." oninput="this.className = ''"></p>
      <p><input placeholder="Password..." oninput="this.className = ''"></p> -->
    </div>

    <div style="overflow:auto;">
      <!-- <div style="float:right; margin-top: 5px;"> -->
      <div style="margin-top: 5px;">
        <button type="button" id="prevBtn" onclick="nextPrev(-1)" class="btn" style="display: none; float: left;">Previous</button>
        <button type="button" id="nextBtn" onclick="nextPrev(1)" class="btn" style="float: right;">Next</button>
      </div>
    </div>

    <!-- Circles which indicates the steps of the form: -->
    <div style="text-align:center;margin-top:40px;">
      <span class="step active"></span>
      <span class="step"></span>
      <span class="hidden" id="optional-span"></span>
      <span class="step"></span>
      <span class="hidden" id="last-span"></span>
    </div>

</form>  <!--   </form> -->
  </div>

</div>



<script type="text/javascript">
  var currentTab = 0; // Current tab is set to be the first tab (0)
  showTab(currentTab); // Display the current tab

  let midwayVenues = document.querySelectorAll(".midway-venue");
  let venueType = "";
  midwayVenues.forEach(venue => {
    // console.log(venue);
    venue.addEventListener("focus", (event) => {
      venueType = event.currentTarget.value;
      displayTab();
    });
  });

  const guestButton = document.getElementById('guest-button');
  const optionalTab = document.getElementById('optional-tab');
  const optionalSpan = document.getElementById('optional-span');
  if(guestButton && optionalTab) {
    guestButton.addEventListener("click", (event) => {
      event.preventDefault();
      guestButton.classList.toggle("guest-active");
      optionalTab.classList.toggle("tab");
      optionalSpan.classList.toggle("hidden");
      optionalSpan.classList.toggle("step");
    })
  };

  function displayTab() {
    if (venueType) {
      console.log(venueType);
      const submitOne = document.getElementById("submit-one");
      const submitTwo = document.getElementById("submit-two");
      const lastSpan = document.getElementById("last-span");

      if (venueType !== "restaurant") {
        submitOne.classList.remove("hidden");
        document.getElementById("nextBtn").style.display = "none";
        lastSpan.classList.add("hidden");
        lastSpan.classList.remove("step");
      } else {
        submitOne.classList.add("hidden");
        document.getElementById("nextBtn").style.display = "inline-block";
        lastSpan.classList.remove("hidden");
        lastSpan.classList.add("step");
        // submitTwo.classList.remove("hidden");
      }
    };
  };



  function showTab(n) {
    // This function will display the specified tab of the form ...
    var x = document.getElementsByClassName("tab");
    x[n].style.display = "block";
    // ... and fix the Previous/Next buttons:
    if (n == 0) {
      document.getElementById("prevBtn").style.display = "none";
    } else {
      document.getElementById("prevBtn").style.display = "inline";
    }
    if (n == (x.length - 1)) {
      document.getElementById("nextBtn").style.display = "none";
    } else {
      document.getElementById("nextBtn").innerHTML = "Next";
    }
    // ... and run a function that displays the correct step indicator:
    fixStepIndicator(n)
  }

  function nextPrev(n) {
    // This function will figure out which tab to display
    var x = document.getElementsByClassName("tab");
    // Exit the function if any field in the current tab is invalid:
    if (n == 1 && !validateForm()) return false;
    // Hide the current tab:
    x[currentTab].style.display = "none";
    // Increase or decrease the current tab by 1:
    currentTab = currentTab + n;
    // if you have reached the end of the form... :
    if (currentTab >= x.length) {
      //...the form gets submitted:
      document.getElementById("regForm").submit();
      return false;
    } else if (n === -1) {
      document.getElementById("nextBtn").style.display = "inline-block";
    } else if (currentTab === x.length - 2) {
      document.getElementById("nextBtn").style.display = "none";
    }
    // Otherwise, display the correct tab:
    showTab(currentTab);
  }

  function validateForm() {
    // This function deals with validation of the form fields
    var x, y, i, valid = true;
    x = document.getElementsByClassName("tab");
    y = x[currentTab].getElementsByTagName("input");
    // A loop that checks every input field in the current tab:
    for (i = 0; i < y.length; i++) {
      // If a field is empty...
      if (y[i].value == "") {
        // add an "invalid" class to the field:
        y[i].className += " invalid";
        // and set the current valid status to false:
        valid = false;
      }
    }
    // // If the valid status is true, mark the step as finished and valid:
    // if (valid) {
    //   document.getElementsByClassName("step")[currentTab].className += " finish";
    // }
    return true; // return the valid status
  }

  function fixStepIndicator(n) {
    // This function removes the "active" class of all steps...
    var i, x = document.getElementsByClassName("step");
    for (i = 0; i < x.length; i++) {
      x[i].className = x[i].className.replace(" active", "");
    }
    //... and adds the "active" class to the current step:
    x[n].className += " active";
  }
</script>

